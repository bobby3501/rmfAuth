!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("DataEngine",[],t):"object"==typeof exports?exports.DataEngine=t():e.DataEngine=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,n){"use strict";(function(e){function i(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function u(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,u)}c((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,s&&(o=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],s=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,s,o,u,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u};Object.defineProperty(t,"__esModule",{value:!0});var u=n(10),c=n(14),a=4300,l=function(e){function t(t,n){var i=e.call(this,t)||this;return Error.captureStackTrace(i,i.constructor),i.progressTimeout=n,i}return r(t,e),t}(Error);t.TimeoutError=l;var h=function(e){function t(t){var n=e.call(this,t)||this;return n.name="AlreadyExistsError",Error.captureStackTrace(n,n.constructor),n}return r(t,e),t}(Error);t.AlreadyExistsError=h,t.generateUUID=i;var f=function(){function e(){this.bucket=null,this.host=null,this.port=null,this.path="",this.apiKey=null,this.secure=!1,this.enablePing=!1,this.pingInterval=5e3,this.clientId=null}return e}();t.DataEngineSettings=f;var p=function(){function e(e){this.bucket=null,this.data=null,this.failIfExists=!1,this.expire=null,this.async=!0,this.forceHttp=!1,this.keysOnly=!1,this.filter=null,e&&(this.bucket=e.bucket,this.data=e.data,this.failIfExists=e.failIfExists,this.expire=e.expire,this.async=e.async,this.forceHttp=e.forceHttp,this.keysOnly=e.keysOnly,this.filter=e.filter)}return e}();t.RequestOptions=p;var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.url=null,t.method=null,t.key=null,t.forceHttp=!1,t.keysOnly=!1,t.filter=null,t}return r(t,e),t}(p);t.RequestOptionsInternal=d;var v=function(){function t(t){this.restClient=null,this.connection=null,this.settings=null,this.pendingRequests=0,this.internalizeRequestOptions=function(e,t){var n=t.bucket||this.settings.bucket;null==t.async&&(t.async=!0);var i=new d(null);return void 0!==t.keysOnly&&(i.keysOnly=t.keysOnly),void 0!==t.filter&&(i.filter=t.filter),i.url=this.getUrl(e,n,i.keysOnly,i.filter),i.bucket=n,i.key=e,i.async=t.async,i.failIfExists=t.failIfExists,i.forceHttp=t.forceHttp,i.expire=t.expire,i},this.checkOptions=function(e){return e instanceof p==!1&&(e=new p(e)),e},this.read=function(e,t){return s(this,void 0,void 0,function(){var n;return o(this,function(i){return n=this.internalizeRequestOptions(e,this.checkOptions(t)),n.method="GET",[2,this.request(n)]})})},this.list=function(e){return s(this,void 0,void 0,function(){var t;return o(this,function(n){return void 0===e.keysOnly&&(e.keysOnly=!0),t=this.internalizeRequestOptions("",this.checkOptions(e)),t.method="GET",[2,this.request(t)]})})},this.write=function(e,t,n){return s(this,void 0,void 0,function(){var i;return o(this,function(r){return i=this.internalizeRequestOptions(e,this.checkOptions(n)),i.method=i.key?"PUT":"POST",i.data=t,[2,this.request(i)]})})},this.patch=function(e,t,n){return s(this,void 0,void 0,function(){var i;return o(this,function(r){return i=this.internalizeRequestOptions(e,this.checkOptions(n)),i.method="PATCH",i.data=t,[2,this.request(i)]})})},this.remove=function(e,t){return s(this,void 0,void 0,function(){var n;return o(this,function(i){return n=this.internalizeRequestOptions(e,this.checkOptions(t)),n.method="DELETE",[2,this.request(n)]})})},this.getUrl=function(e,t,n,i){e||(e="");var r="d="+(new Date).getTime();return r=(e.indexOf("?")>-1?"&":"?")+r,n&&(r+="&keysOnly=true"),null!=i&&""!==i&&(r=r+"&filter="+i),(this.settings.secure?"https://":"http://")+this.settings.host+":"+this.settings.port+this.settings.path+"_data/"+t+"/"+e+r},this.request=function(t){return s(this,void 0,void 0,function(){var n,i,r,s,u=this;return o(this,function(o){return r=new Promise(function(e,t){n=e,i=t}),void 0===t.async&&(t.async=!0),s={resolve:n,reject:i,options:t},e(function(){u.requestQueue.unshift(s),u.processRequestQueue()}),[2,r]})})},this.close=function(){this.connection.close()};this.restClient=u,null==t&&(t=new f),t.host=t.host||"127.0.0.1",t.port=t.port||a,"string"!=typeof t.path&&(t.path=""),""!==t.path&&"/"!==t.path.charAt(0)&&(t.path="/"+t.path),"/"!==t.path.charAt(t.path.length-1)&&(t.path=t.path+"/"),this.settings=t,this.connection=new c.PersistentConnection(t),this.requestQueue=[]}return t.prototype.requestHttp=function(e){return s(this,void 0,void 0,function(){var t,n;return o(this,function(i){return t=e.method||"GET",n={method:t,path:e.url,headers:{},entity:{}},this.settings.apiKey&&(n.headers["API-key"]=this.settings.apiKey),"PUT"!=t&&"POST"!=t&&"PATCH"!=t||(n.entity=JSON.stringify(e.data),n.headers["Content-Type"]="application/json",e.failIfExists&&(n.headers.failIfExists=e.failIfExists),e.expire&&(n.headers.expire=e.expire)),[2,this.restClient(n).then(function(n){if("GET"===t&&[200,304].indexOf(n.status.code)>-1)return JSON.parse(n.entity);if(["POST","PUT"].indexOf(t)>-1&&[200,201].indexOf(n.status.code)>-1){var i=e.key;return 201===n.status.code&&(i=n.headers.location),i}if(!("DELETE"===t&&[200,404].indexOf(n.status.code)>-1)&&200!=n.status.code)throw new Error(n.status.code)})]})})},t.prototype.processRequestQueue=function(){var t=this;if(!(this.pendingRequests>=50||0===this.requestQueue.length)){var n=this.requestQueue.pop();this.pendingRequests++;var i;i=this.connection&&n.options.async&&this.connection.connected&&!n.options.forceHttp?this.connection.request(n.options):this.requestHttp(n.options),i.then(function(i){t.pendingRequests--,n.resolve(i),e(t.processRequestQueue.bind(t))}).catch(function(i){t.pendingRequests--,n.reject(i),e(t.processRequestQueue.bind(t))})}},t}();t.DataEngine=v}).call(t,n(1).setImmediate)},function(e,t,n){function i(e,t){this._id=e,this._clearFn=t}var r=Function.prototype.apply;t.setTimeout=function(){return new i(r.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(r.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(7),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(e,t,n){"use strict";/*
 * Copyright 2014-2016 the original author or authors
 * @license MIT, see LICENSE.txt for details
 *
 * @author Scott Andrews
 */
e.exports=function(e,t){return t&&(e.skip=function(){return t}),e.wrap=function(t,n){return t(e,n)},e.chain=function(){return"undefined"!=typeof console&&console.log("rest.js: client.chain() is deprecated, use client.wrap() instead"),e.wrap.apply(this,arguments)},e}},function(e,t,n){"use strict";/*
 * Copyright 2012-2016 the original author or authors
 * @license MIT, see LICENSE.txt for details
 *
 * @author Scott Andrews
 */
function i(e){return e.toLowerCase().split("-").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join("-")}e.exports=i},function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function u(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,u)}c((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,s&&(o=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],s=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,s,o,u,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u};Object.defineProperty(t,"__esModule",{value:!0});var u=n(0),c=n(18),a=n(1),l="messaging.compcon",h=1e4,f=1e4;t.JOB_NOT_SUPPORTED=100,t.NO_WORKER_AVAILABLE=200;var p=function(){function e(e){this.available=!0,this.release=function(){this.available=!0},this.id=e}return e}();t.Worker=p;var d=function(){function e(e){var t=(new Date).valueOf();this.lastProgress=t,this.publishTime=t,this.callback=e}return e}(),v=function(){function e(e,t,n,i){var r=this;this.pendingJobs={},this.de=null,this.jobQueue=l+"."+t+".jobs",this.statusQueue=l+"."+t+".status",this.timeout=n||h,this.progressTimeout=i||f,this.de=e,this.jobStatusQueueListener=function(e){r.pendingJobs[e.key]&&(r.pendingJobs[e.key].lastProgress=(new Date).valueOf(),r.pendingJobs[e.key].callback(e.value.err,e.value),e.value.done&&(r.pendingJobs[e.key]=null))},e.connection.addListener(this.statusQueue,"*",!0,this.jobStatusQueueListener)}return e.prototype.destroy=function(){this.de.connection&&this.de.connection.removeListener(this.jobStatusQueueListener)},e.prototype.addJob=function(e,t,n,i){return s(this,void 0,void 0,function(){var r,s=this;return o(this,function(o){switch(o.label){case 0:return n=n||this.timeout,i=i||this.progressTimeout,r=u.generateUUID(),[4,this.de.connection.write(this.jobQueue,r,e)];case 1:return o.sent(),[2,new Promise(function(e,o){var c=setInterval(function(){var e=(new Date).valueOf(),t=e>s.pendingJobs[r].lastProgress+i,l=e>s.pendingJobs[r].publishTime+n;(t||l)&&(s.pendingJobs[r]=null,a.clearInterval(c),o(new u.TimeoutError("Timeout for job id "+r,t)))},500);s.pendingJobs[r]=new d(function(n,i){n?(a.clearInterval(c),o(new Error(n))):i.value.done?(a.clearInterval(c),e(i.value),s.de.connection.delete(s.statusQueue,i.key)):"function"==typeof t&&t(i.value)})})]}})})},e}();t.Producer=v;var y=function(e){function n(n,i){var r=e.call(this)||this;return r.waitForWorker=function(e){return s(this,void 0,void 0,function(){var n=this;return o(this,function(i){return[2,new Promise(function(i,r){var s=setInterval(function(){n.onJobQuery(e,function(o,u){if(null==o)return a.clearInterval(s),n.emit("job",{id:e.id,status:"Worker assigned"}),void i(u);o==t.JOB_NOT_SUPPORTED?(a.clearInterval(s),n.emit("job",{id:e.id,error:"Not supported"}),r(new Error("Job not supported"))):o==t.NO_WORKER_AVAILABLE||(a.clearInterval(s),n.emit("job",{id:e.id,errno:o}),r(new Error(o)))})},100)})]})})},r.statusQueue=l+"."+i+".status",r.jobQueue=l+"."+i+".jobs",r.de=n,r.jobQueueListener=function(e){e.isDeleted||null==e.value||r.jobHandler(e.key,e.value).catch(function(t){return r.emit("job",{id:e.value.id,status:"No worker"})})},n.connection.addListener(r.jobQueue,"*",!0,r.jobQueueListener),r}return i(n,e),n.prototype.destroy=function(){this.de.connection.removeListener(this.jobQueueListener),this.removeAllListeners()},n.prototype.jobHandler=function(e,t){return s(this,void 0,void 0,function(){var n,i,s,c,a=this;return o(this,function(o){switch(o.label){case 0:return this.emit("job",{id:t.id,status:"Job received"}),[4,this.waitForWorker(t)];case 1:n=o.sent(),i=this.de.connection.id,o.label=2;case 2:return o.trys.push([2,6,,7]),s={claim:{id:i},done:!1,err:null,data:null,progress:null},[4,this.de.connection.write(this.statusQueue,e,s,!0)];case 3:return o.sent(),[4,this.de.connection.delete(this.jobQueue,e)];case 4:return o.sent(),[4,n.work(t,function(n,i){n instanceof Error&&(n=n.message),a.emit("job",{id:t.id,done:!0,data:i}),a.de.connection.write(a.statusQueue,e,r({},s,{err:n,data:i,done:!0}))},function(n){a.emit("job",{id:t.id,done:!1,progress:n}),a.de.connection.write(a.statusQueue,e,r({},s,{progress:n}))})];case 5:return o.sent(),[3,7];case 6:if(c=o.sent(),n.release(),!(c instanceof u.AlreadyExistsError))throw c;return[3,7];case 7:return[2]}})})},n}(c.EventEmitter);t.CompetingConsumer=y},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function u(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,u)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,s&&(o=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],s=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,s,o,u,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),o="#reqrep/",u="#reqrep-progress/",c=function(){function e(e,t){var n=(new Date).valueOf();this.lastProgress=n,this.requestTime=n,this.reply=e,this.progress=t}return e}(),a=function(){function e(e,t,n,a){var l=this;this.pendingRequests={},this.request=function(e,t,n,o){return i(this,void 0,void 0,function(){var i=this;return r(this,function(r){return n=n||this.timeout,o=o||this.progressTimeout,[2,new Promise(function(r,u){var a=s.generateUUID();i.de.connection.signalEvent(i.channel,a,e);var l=setInterval(function(){var e=(new Date).valueOf(),t=e>i.pendingRequests[a].lastProgress+o,r=e>i.pendingRequests[a].requestTime+n;(t||r)&&(i.pendingRequests[a]=null,clearInterval(l),u(new s.TimeoutError("Timeout in request id "+a,t)))},500);(new Date).valueOf();i.pendingRequests[a]=new c(function(e,t){clearInterval(l),e?u(new Error(e)):r(t)},t)})]})})},this.timeout=n||5e3,this.progressTimeout=a||5e3,this.channel=o+t,this.progressChannel=u+t,this.de=e,this.progressListener=function(e){var t=l.pendingRequests[e.key];t&&(t.lastProgress=(new Date).valueOf(),"function"==typeof t.progress&&t.progress(e.value.data))},this.replyListener=function(e){l.pendingRequests[e.key]&&(l.pendingRequests[e.key].reply(e.value.err,e.value.data),l.pendingRequests[e.key]=null)},e.connection.addListener(this.channel,"*",!0,this.replyListener),e.connection.addListener(this.progressChannel,"*",!0,this.progressListener)}return e.prototype.destroy=function(){this.de.connection.removeListener(this.progressListener),this.de.connection.removeListener(this.replyListener)},e}();t.Requestor=a;var l=function(){function e(e,t){var n=this;this.channel=o+t,this.progressChannel=u+t,this.de=e,this.requestListener=function(e){n.onMessage(e.value,function(t,i){var r=t instanceof Error?t.message:t;n.de.connection.signalEvent(n.channel,e.key,{err:r,data:i})},function(t){n.de.connection.signalEvent(n.progressChannel,e.key,{data:t})})},e.connection.addListener(this.channel,"*",!0,this.requestListener)}return e.prototype.destroy=function(){this.de.connection.removeListener(this.requestListener)},e}();t.Replier=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.DataEngine=i.DataEngine,t.DataEngineSettings=i.DataEngineSettings,t.RequestOptions=i.RequestOptions;var r=n(4),s=n(5),o=n(4);!function(e){!function(e){e.Requestor=s.Requestor,e.Replier=s.Replier}(e.RequestReply||(e.RequestReply={}));!function(e){e.CompetingConsumer=r.CompetingConsumer,e.Producer=r.Producer}(e.CompetingConsumers||(e.CompetingConsumers={}));!function(e){e.JOB_NOT_SUPPORTED=o.JOB_NOT_SUPPORTED,e.NO_WORKER_AVAILABLE=o.NO_WORKER_AVAILABLE}(e.Errors||(e.Errors={}))}(t.Messaging||(t.Messaging={}));var u=n(5);t.Requestor=u.Requestor,t.Replier=u.Replier},function(e,t,n){(function(e,t){!function(e,n){"use strict";function i(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return a[c]=i,u(c),c++}function r(e){delete a[e]}function s(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}function o(e){if(l)setTimeout(o,0,e);else{var t=a[e];if(t){l=!0;try{s(t)}finally{r(e),l=!1}}}}if(!e.setImmediate){var u,c=1,a={},l=!1,h=e.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(e);f=f&&f.setTimeout?f:e,"[object process]"==={}.toString.call(e.process)?function(){u=function(e){t.nextTick(function(){o(e)})}}():function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&o(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),u=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){o(e.data)},u=function(t){e.port2.postMessage(t)}}():h&&"onreadystatechange"in h.createElement("script")?function(){var e=h.documentElement;u=function(t){var n=h.createElement("script");n.onreadystatechange=function(){o(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():function(){u=function(e){setTimeout(o,0,e)}}(),f.setImmediate=i,f.clearImmediate=r}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(8),n(9))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function s(e){if(h===clearTimeout)return clearTimeout(e);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function o(){v&&p&&(v=!1,p.length?d=p.concat(d):y=-1,d.length&&u())}function u(){if(!v){var e=r(o);v=!0;for(var t=d.length;t;){for(p=d,d=[];++y<t;)p&&p[y].run();y=-1,t=d.length}p=null,v=!1,s(e)}}function c(e,t){this.fun=e,this.array=t}function a(){}var l,h,f=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(e){h=i}}();var p,d=[],v=!1,y=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new c(e,t)),1!==d.length||v||r(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=a,f.addListener=a,f.once=a,f.off=a,f.removeListener=a,f.removeAllListeners=a,f.emit=a,f.prependListener=a,f.prependOnceListener=a,f.listeners=function(e){return[]},f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(e,t,n){"use strict";/*
 * Copyright 2014-2016 the original author or authors
 * @license MIT, see LICENSE.txt for details
 *
 * @author Scott Andrews
 */
var i=n(11),r=n(12);i.setPlatformDefaultClient(r),e.exports=i},function(e,t,n){"use strict";function i(){return s.apply(void 0,arguments)}/*
 * Copyright 2014-2016 the original author or authors
 * @license MIT, see LICENSE.txt for details
 *
 * @author Scott Andrews
 */
var r,s,o;r=n(2),"function"!=typeof Promise&&console&&console.log&&console.log("An ES6 Promise implementation is required to use rest.js. See https://github.com/cujojs/when/blob/master/docs/es6-promise-shim.md for using when.js as a Promise polyfill."),i.setDefaultClient=function(e){s=e},i.getDefaultClient=function(){return s},i.resetDefaultClient=function(){s=o},i.setPlatformDefaultClient=function(e){if(o)throw new Error("Unable to redefine platformDefaultClient");s=o=e},e.exports=r(i)},function(e,t,n){"use strict";function i(e){var t={};return e?(e.trim().split(c).forEach(function(e){var n,i,r;n=e.indexOf(":"),i=s(e.substring(0,n).trim()),r=e.substring(n+1).trim(),t[i]?Array.isArray(t[i])?t[i].push(r):t[i]=[t[i],r]:t[i]=r}),t):t}function r(e,t){return Object.keys(t||{}).forEach(function(n){if(t.hasOwnProperty(n)&&n in e)try{e[n]=t[n]}catch(e){}}),e}/*
 * Copyright 2012-2016 the original author or authors
 * @license MIT, see LICENSE.txt for details
 *
 * @author Scott Andrews
 */
var s,o,u,c;s=n(3),o=n(13),u=n(2),c=/[\r|\n]+/,e.exports=u(function(e){return o.promise(function(t,n){var s,o,u,c,a,l,h,f;if(e="string"==typeof e?{path:e}:e||{},h={request:e},e.canceled)return h.error="precanceled",void n(h);if(!(f=e.engine||XMLHttpRequest))return void n({request:e,error:"xhr-not-available"});a=e.entity,e.method=e.method||(a?"POST":"GET"),o=e.method,u=h.url=e.path||"";try{s=h.raw=new f,r(s,e.mixin),s.open(o,u,!0),r(s,e.mixin),c=e.headers;for(l in c)"Content-Type"===l&&"multipart/form-data"===c[l]||s.setRequestHeader(l,c[l]);e.canceled=!1,e.cancel=function(){e.canceled=!0,s.abort(),n(h)},s.onreadystatechange=function(){e.canceled||s.readyState===(f.DONE||4)&&(h.status={code:s.status,text:s.statusText},h.headers=i(s.getAllResponseHeaders()),h.entity=s.responseText,1223===h.status.code&&(h.status.code=204),h.status.code>0?t(h):setTimeout(function(){t(h)},0))};try{s.onerror=function(){h.error="loaderror",n(h)}}catch(e){}s.send(a)}catch(e){h.error="loaderror",n(h)}})})},function(e,t,n){"use strict";function i(e,t){return e.then(function(e){return e&&e[t]},function(e){return Promise.reject(e&&e[t])})}function r(){return i(this,"entity")}function s(){return i(i(this,"status"),"code")}function o(){return i(this,"headers")}function u(e){return e=h(e),i(this.headers(),e)}function c(e){return e=[].concat(e),a(e.reduce(function(e,t){return e.then(function(e){if("string"==typeof t&&(t={rel:t}),"function"!=typeof e.entity.clientFor)throw new Error("Hypermedia response expected");return e.entity.clientFor(t.rel)({params:t.params})})},this))}function a(e){return e.status=s,e.headers=o,e.header=u,e.entity=r,e.follow=c,e}function l(e,t,n){return a(Promise.resolve(e).then(t,n))}/*
 * Copyright 2014-2016 the original author or authors
 * @license MIT, see LICENSE.txt for details
 *
 * @author Scott Andrews
 */
var h=n(3);l.make=a,l.reject=function(e){return a(Promise.reject(e))},l.promise=function(e){return a(new Promise(e))},e.exports=l},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function u(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,u)}c((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,s&&(o=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],s=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,s,o,u,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u};Object.defineProperty(t,"__esModule",{value:!0});var s=n(15).w3cwebsocket,o=n(0),u=3e3,c=function(){function e(e){this.connected=!1,this.id=null,this.enablePing=!1,this.requestID=0,this.events=[],this.sendValues=!1,this.ws=null,this.eventsReceived=0,this.skipReconnect=!1,this.connection=null,this.requests=[],this.requestTimer=null,this.reconnectTimer=null,this.pingTimer=null,this.pingInterval=5e3,this.request=function(e){return i(this,void 0,void 0,function(){var t,n;return r(this,function(i){return e.key||(e.key=""),t=e.bucket||this.settings.bucket,n=e.method||"GET","GET"===n&&""===e.key?[2,this.list(t,e.keysOnly,e.filter)]:"GET"===n?[2,this.read(t,e.key)]:"POST"===n||"PUT"===n?[2,this.write(t,e.key,e.data,e.failIfExists,e.expire)]:"DELETE"===n?[2,this.delete(t,e.key)]:"PATCH"===n?[2,this.patch(t,e.key,e.data)]:"EVENT"===n?[2,this.signalEvent(t,e.key,e.data)]:[2]})})},this.read=function(e,t){return i(this,void 0,void 0,function(){var n=this;return r(this,function(i){return[2,new Promise(function(i,r){n.addRequest({op:"read",bucket:e,key:t},function(n,s){n?r(new Error("DataEngine ws READ error: "+JSON.stringify(n)+" for bucket: "+e+", key: "+t)):i(s)})})]})})},this.list=function(e,t,n){return i(this,void 0,void 0,function(){var i=this;return r(this,function(r){return[2,new Promise(function(r,s){i.addRequest({op:"filter",bucket:e,keysOnly:t,filter:n},function(t,n){t?s(new Error("DataEngine ws FILTER error: "+JSON.stringify(t)+" for bucket: "+e)):r(n)})})]})})},this.write=function(e,t,n,s,u){return i(this,void 0,void 0,function(){var i=this;return r(this,function(r){return[2,new Promise(function(r,c){i.addRequest({op:"write",bucket:e,key:t,value:n,failIfExists:s,expire:u},function(n,i){if(n){var s=n.alreadyExists?new o.AlreadyExistsError("Key "+t+" already exists"):new Error("DataEngine ws WRITE error: "+JSON.stringify(n)+" for bucket: "+e+", key: "+t);c(s)}else r(i)})})]})})},this.patch=function(e,t,n){return i(this,void 0,void 0,function(){var i=this;return r(this,function(r){return[2,new Promise(function(r,s){i.addRequest({op:"patch",bucket:e,key:t,patch:n},function(n,i){n?s(new Error("DataEngine ws PATCH error: "+JSON.stringify(n)+" for bucket: "+e+", key: "+t)):r(i)})})]})})},this.delete=function(e,t){return i(this,void 0,void 0,function(){var n=this;return r(this,function(i){return[2,new Promise(function(i,r){n.addRequest({op:"remove",bucket:e,key:t},function(n){n?r(new Error("DataEngine ws REMOVE error: "+JSON.stringify(n)+" for bucket: "+e+", key: "+t)):i()})})]})})},this.signalEvent=function(e,t,n){return i(this,void 0,void 0,function(){var i;return r(this,function(r){return i={bucket:e,key:t,value:n},this.connected?(this.ws.send(JSON.stringify({msg:"event-broadcast",event:i})),[2,Promise.resolve()]):[2,Promise.reject(new Error("Cannot call SignalEvent when disconnected"))]})})},this.close=function(){this.events=[],this.skipReconnect=!0,this.connected=!1,this.ws&&this.ws.close&&this.ws.close(),this.ws=null,clearTimeout(this.reconnectTimer),clearInterval(this.pingTimer),clearTimeout(this.requestTimer)},this.addListener=function(e,t,n,i){if(null==i||"function"!=typeof i)throw"Callback is not a function";n&&(this.sendValues=!0),this.events.push({bucket:e,key:t,callback:i}),this.registerEvents()},this.removeListener=function(e){this.events=this.events.filter(function(t){return t.callback!==e}),this.registerEvents()},this.addRequest=function(e,t){this.requestID=this.requestID+1,this.requests[this.requestID]={timeStamp:new Date,callback:t},e.id=this.requestID+"",this.ws.send(JSON.stringify({msg:"datastore-operation",request:e}))},this.handleReponse=function(e){this.requests[e.id]&&(this.requests[e.id].callback(e.error,e.value||e.location),this.requests[e.id]=null)},this.checkRequestTimeouts=function(){var e=this;this.requestTimer=setTimeout(function(){for(var t in e.requests){var n=e.requests[t+""];if(n){(new Date).getTime()-e.requests[t].timeStamp>u&&(n.callback("Timeout occured for request "+n.id),e.requests[t]=null)}}e.skipReconnect||e.checkRequestTimeouts()},1e3)},this.registerEvents=function(){if(this.connected){for(var e=[],t=[],n=0;n<this.events.length;n++){var i=JSON.stringify(this.events[n]);e[i]||(t.push({bucket:this.events[n].bucket,key:this.events[n].key}),e[i]=!0)}this.ws.send(JSON.stringify({msg:"register-events",events:t,sendValues:this.sendValues}))}},this.enablePing=e.enablePing,this.pingInterval=e.pingInterval||this.pingInterval;var t=e.secure?"wss://":"ws://";this.wsStart(t+e.host+":"+e.port+e.path+"?id="+e.clientId),this.checkRequestTimeouts()}return e.prototype.wsStart=function(e){var t=this;this.skipReconnect=!1,this.connected=!1,this.connection=null,this.pingTimer&&clearInterval(this.pingTimer),this.ws&&this.ws.close&&this.ws.close(),this.ws=new s(e,"",null,null,null,{maxReceivedMessageSize:134217728}),this.enablePing&&(this.pingTimer=setInterval(function(){null!=t.ws&&t.connected&&t.ws.send(JSON.stringify({msg:"ping"}))},this.pingInterval)),this.ws.onerror=function(e){"function"==typeof t.onError&&t.onError(e)},this.ws.onmessage=function(e){var n=JSON.parse(e.data);if(n.id)return t.id=n.id,void("function"==typeof t.onConnect&&t.onConnect(t));if(n.response)return void t.handleReponse(n.response);if(n.pong)return void("function"==typeof t.onPong&&t.onPong());t.eventsReceived++;var i=void 0!==n.value&&void 0===n.isDeleted?n.value:null,r={bucket:n.bucket,key:n.key,value:i,isDeleted:null};n.isDeleted&&(r.isDeleted=!0);for(var s=0;s<t.events.length;s++)"*"!==t.events[s].bucket&&t.events[s].bucket!=r.bucket||"*"!==t.events[s].key&&t.events[s].key!=r.key||t.events[s].callback(r)},this.ws.onclose=function(){t.connected&&(t.connected=!1,t.connection=null,"function"==typeof t.onDisconnect&&t.onDisconnect(t)),t.skipReconnect||(t.reconnectTimer=setTimeout(function(){t.skipReconnect||t.wsStart(e)},3e3))},this.ws.onopen=function(){t.connected=!0,t.registerEvents()}},e}();t.PersistentConnection=c},function(e,t,n){function i(e,t){return t?new s(e,t):new s(e)}var r=function(){return this}(),s=r.WebSocket||r.MozWebSocket,o=n(16);s&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(i,e,{get:function(){return s[e]}})}),e.exports={w3cwebsocket:s?i:null,version:o}},function(e,t,n){e.exports=n(17).version},function(e,t){e.exports={_from:"websocket@~1.0.25",_id:"websocket@1.0.25",_inBundle:!1,_integrity:"sha512-M58njvi6ZxVb5k7kpnHh2BvNKuBWiwIYvsToErBzWhvBZYwlEiLcyLrG41T1jRcrY9ettqPYEqduLI7ul54CVQ==",_location:"/websocket",_phantomChildren:{},_requested:{type:"range",registry:!0,raw:"websocket@~1.0.25",name:"websocket",escapedName:"websocket",rawSpec:"~1.0.25",saveSpec:null,fetchSpec:"~1.0.25"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.25.tgz",_shasum:"998ec790f0a3eacb8b08b50a4350026692a11958",_spec:"websocket@~1.0.25",_where:"/Users/peter/dev/dataengine/client-libs/nodejs",author:{name:"Brian McKelvey",email:"brian@worlize.com",url:"https://www.worlize.com/"},browser:"lib/browser.js",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},bundleDependencies:!1,config:{verbose:!1},contributors:[{name:"Iñaki Baz Castillo",email:"ibc@aliax.net",url:"http://dev.sipdoc.net"}],dependencies:{debug:"^2.2.0",nan:"^2.3.3","typedarray-to-buffer":"^3.1.2",yaeti:"^0.0.6"},deprecated:!1,description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",devDependencies:{"buffer-equal":"^1.0.0",faucet:"^0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^2.0.4",jshint:"^2.0.0","jshint-stylish":"^2.2.1",tape:"^4.0.1"},directories:{lib:"./lib"},engines:{node:">=0.10.0"},homepage:"https://github.com/theturtle32/WebSocket-Node",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],license:"Apache-2.0",main:"index",name:"websocket",repository:{type:"git",url:"git+https://github.com/theturtle32/WebSocket-Node.git"},scripts:{gulp:"gulp",install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit"},version:"1.0.25"}},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function r(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!r(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,r,u,c,a;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],o(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),n.apply(this,u)}else if(s(n))for(u=Array.prototype.slice.call(arguments,1),a=n.slice(),r=a.length,c=0;c<r;c++)a[c].apply(this,u);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(r=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,r,o,u;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(u=o;u-- >0;)if(n[u]===t||n[u].listener&&n[u].listener===t){r=u;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}}])});